# 商品管理システム セットアップガイド

このプロジェクトは、Dockerを使用してNext.js、Prisma、MySQLのフルスタック環境を構築します。
ホストマシンへのNode.jsインストールは不要です。

## 1. 前提条件

以下のツールがインストールされていることを確認してください。
- Docker Desktop
- Make (macOS/Linux標準)

## 2. 初回起動手順

リポジトリをクローンした後、以下のコマンドを実行してください。

```bash
make dev
```

このコマンドにより、以下の処理が自動的に実行されます。
1. MySQL 8.0 コンテナの起動
2. データベースの接続待機
3. Prisma Migration によるテーブル作成
4. 初期データの投入 (Seed)
5. Next.js 開発サーバーの起動 (http://localhost:3000)

## 3. エディタの赤線を消す方法 (推奨)

エディタ(Cursor/VS Code)上で型定義エラー（赤線）を消すには、ホスト側でもライブラリをインストールする必要があります。
※ホスト側にNode.jsがインストールされている場合のみ実行してください。

```bash
cd apps/web
npm install
```

## 4. 主要コマンド一覧

| コマンド | 内容 |
| :--- | :--- |
| make dev | アプリケーションの起動 |
| make down | サービスの停止 |
| make reset-db | DBボリュームを削除して完全初期化 |
| make logs | ログのリアルタイム表示 |
| make shell | webコンテナ内でのシェル操作 |
| make migrate | データベーススキーマの手動更新 |
| make seed | 初期データの再投入 |

## 5. アクセス先

- アプリケーション: http://localhost:3000/products
- ヘルスチェックAPI: http://localhost:3000/api/health

## 6. トラブルシューティング

### ポート競合
3000番または3306番ポートが既に使用されている場合は、既存のプロセスを停止してください。

### データベース接続エラー
初回起動時、MySQLの初期化に時間がかかる場合があります。
接続に失敗し続ける場合は、一度停止してから再度実行してください。

```bash
make down
make dev
```

### macOSでの開発ツールエラー
xcrunエラーが表示される場合は、以下のコマンドを実行してください。

```bash
xcode-select --install
sudo xcode-select --reset
```

## 7. セキュリティについて

開発の利便性を優先し、docker-compose.ymlに接続情報を記載しています。
本番環境へ転用する場合は、必ず環境変数によるシークレット管理に置き換えてください。
また、セキュリティリスク回避のため、Next.jsの画像最適化機能は無効化（unoptimized）設定としています。
